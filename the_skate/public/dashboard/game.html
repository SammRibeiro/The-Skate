<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="/The-Skate/the_skate/public/assets/icon/logo_site.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Skate</title>


    <link rel="stylesheet" href="../css/dashboards.css">
    <script src="../js/sessao.js"></script>

</head>

<body>

    <div class="container">
        <div class="header-left">
            <img style="width: 300px;" src="../assets/icon/logo_site.png" alt="">

            <div class="hello">
                <h2>Olá, <span id="b_usuario"></span>! </h2>
            </div>

            <div class="btn-dashpage">
                <a href="dashboard.html">
                    <h3>Painel</h3>
                </a>
            </div>


            <div class="ativo" class="btn-gamepage">
                <a href="game.html">
                    <h3>Game of Skate</h3>
                </a>
            </div>

            <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>

        </div>


        <div class="content-game">
            <div class="card-game">

                <div id="mensagem_game">
                    Para tornar o seu game mais desafiador, nessa página você sorteia uma manobra aleatória para
                    praticar ou competir com seu mano. <br><br>
                    Preparado?
                    <br><br>
                    Sorteie uma manobra e o game já está valendo !!
                </div>

                <div id="imagem_manobra" class="imagem"></div>
            </div>

            <button onclick="sortearManobra()" id="btn_sorteio">
                <h3>
                    Sortear Manobra
                </h3>
            </button>

            <div class="div_desempenho">
                <button id="btn_acerto" onclick="acerto()" disabled>
                    <h3>Acerto</h3>
                </button>
                <button id="btn_erro" onclick="erro()" disabled>
                    <h3>Erro</h3>
                </button>
                <button id="btn_reset" onclick="finalizarGame()" disabled>
                    <h3>Finalizar Game</h3>
                </button>
            </div>
        </div>

    </div>





</body>

<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    var manobras = [
        '<img src="../assets/imgs/ollie.jpg" alt="Ollie">',
        '<img src="../assets/imgs/impossible.jpg" alt="Impossible">',
        '<img src="../assets/imgs/kick.jpg" alt="Flip">',
        '<img src="../assets/imgs/noseblunt.jpg" alt="NoseBlunt">',
        '<img src="../assets/imgs/hardflip.jpg" alt="Hardflip">',
        '<img src="../assets/imgs/fsinvert.jpg" alt="FsInvert">',
        '<img src="../assets/imgs/fiftyslide.jpg" alt="FiftySlide">',
        '<img src="../assets/imgs/crookedslide.jfif" alt="CrookedSlide">',
        '<img src="../assets/imgs/boardslide.jfif" alt="BoardSlide">',
        '<img src="../assets/imgs/tailslide.jpg" alt="TailSlide">'
    ]

    var nome_manobra = [
        'Ollie',
        'Impossible',
        'Kickflip',
        'Nose Blunt',
        'HardFlip',
        'Fs Invert',
        '50-50',
        'Crooked',
        'Board Slide',
        'Tail Slide'
    ]

    var manobra_forte = ''

    var acerto_ollie = 0
    var acerto_impossible = 0
    var acerto_kickflip = 0
    var acerto_nose_blunt = 0
    var acerto_hardflip = 0
    var acerto_fs_invert = 0
    var acerto_50_50 = 0
    var acerto_crooked = 0
    var acerto_board_slide = 0
    var acerto_tail_slide = 0



    var quantidade_manobras = 0
    var acertos = 0
    var erros = 0

    var ax_manobra_sorteada = 0
    function sortearManobra() {

        if (btn_reset.disabled == true) {

            erros = 0
            acertos = 0
            quantidade_manobras = 0


            acerto_ollie = 0
            acerto_impossible = 0
            acerto_kickflip = 0
            acerto_nose_blunt = 0
            acerto_hardflip = 0
            acerto_fs_invert = 0
            acerto_50_50 = 0
            acerto_crooked = 0
            acerto_board_slide = 0
            acerto_tail_slide = 0

            manobra_forte = ''

        }



        ax_manobra_sorteada = Math.floor(Math.random() * manobras.length)
        quantidade_manobras++

        mensagem_game.style.display = 'none'
        imagem_manobra.style.display = 'block'

        imagem_manobra.innerHTML = `${manobras[ax_manobra_sorteada]} ${nome_manobra[ax_manobra_sorteada]}`

        btn_acerto.disabled = false
        btn_erro.disabled = false
        btn_sorteio.disabled = true
        btn_reset.disabled = true
    }


    function acerto() {
        acertos++

        if (ax_manobra_sorteada == 0) { acerto_ollie++ }
        if (ax_manobra_sorteada == 1) { acerto_impossible++ }
        if (ax_manobra_sorteada == 2) { acerto_kickflip++ }
        if (ax_manobra_sorteada == 3) { acerto_nose_blunt++ }
        if (ax_manobra_sorteada == 4) { acerto_hardflip++ }
        if (ax_manobra_sorteada == 5) { acerto_fs_invert++ }
        if (ax_manobra_sorteada == 6) { acerto_50_50++ }
        if (ax_manobra_sorteada == 7) { acerto_crooked++ }
        if (ax_manobra_sorteada == 8) { acerto_board_slide++ }
        if (ax_manobra_sorteada == 9) { acerto_tail_slide++ }

        btn_erro.disabled = true
        btn_sorteio.disabled = false
        btn_acerto.disabled = true
        btn_reset.disabled = false
    }


    function erro() {
        erros++
        btn_acerto.disabled = true
        btn_sorteio.disabled = false
        btn_erro.disabled = true
        btn_reset.disabled = false
    }

    function finalizarGame() {
        mensagem_game.style.display = 'block'
        imagem_manobra.style.display = 'none'

        var aproveitamento = ((acertos / quantidade_manobras) * 100).toFixed(1);

        var lista_acertos = [
            acerto_ollie,
            acerto_impossible,
            acerto_kickflip,
            acerto_nose_blunt,
            acerto_hardflip,
            acerto_fs_invert,
            acerto_50_50,
            acerto_crooked,
            acerto_board_slide,
            acerto_tail_slide,
        ];

        var ax_manobraForte = 0;
        var maior_acerto = lista_acertos[0]

        for (var i = 1; i < lista_acertos.length; i++) {
            if (lista_acertos[i] > maior_acerto) {
                maior_acerto = lista_acertos[i];
                ax_manobraForte = i;
            }
        }

        manobra_forte = nome_manobra[ax_manobraForte]


        console.log(manobra_forte)

        mensagem_game.innerHTML = `<span>
        Total de Manobras sorteadas: ${quantidade_manobras} Manobras
        <br>
        Acertos: ${acertos} Manobras 
        <br>
        Erros: ${erros} Manobras
        <br>
        Aproveitamento: ${aproveitamento}%
        <br><br><br></span>`

        if (aproveitamento > 50) {
            mensagem_game.innerHTML += `<span>Mandou bem demais ${sessionStorage.NOME_USUARIO}, foi um desempenho maneiro !! <br><br> *O progresso é salvo automaticamente e você pode vizualisar seu desempenho na seção do Painel.*</span>`
        }
        else {
            mensagem_game.innerHTML += '<span>Mandou bem, porém com mais prática podemos melhorar esse resultado !! <br><br> *O progresso é salvo automaticamente e você pode visualizar seu desempenho na seção do Painel.*</span>'
        }

        setTimeout(function () {
            mensagem_game.innerHTML = 'Preparado para outro game? <br><br><br> Se sim, sorteia outra manobra aí !!'
        }, 15000);




        fetch("/partidas/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                fkUsuarioServer: sessionStorage.ID_USUARIO,
                quantidade_manobrasServer: quantidade_manobras,
                acertosServer: acertos,
                errosServer: erros,
                manobra_forteServer: manobra_forte
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    console.log('Partida Registrada com sucesso')
                } else {
                    console.log('Estou no fetch de game.html')
                    console.log('Erro ao registrar partida')
                }
            })
            .catch(function (erro) {
                console.log(erro);
            });






        btn_acerto.disabled = true
        btn_reset.disabled = true
        btn_erro.disabled = true
        btn_sorteio.disabled = false
    }
</script>

</html>